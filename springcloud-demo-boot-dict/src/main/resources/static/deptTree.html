<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jstree basic demos</title>
    <style>
        html {
            margin: 0;
            padding: 0;
            font-size: 62.5%;
        }

        body {
            max-width: 800px;
            min-width: 300px;
            margin: 0 auto;
            padding: 20px 10px;
            font-size: 14px;
            font-size: 1.4em;
        }

        h1 {
            font-size: 1.8em;
        }

        .demo {
            overflow: auto;
            border: 1px solid silver;
            min-height: 100px;
        }
    </style>
    <link rel="stylesheet" href="./jstree/themes/default/style.css"/>
</head>
<body>

<h1>龙生九子</h1>
<div id="deptTree" class="demo"></div>

<script src="jquery-3.3.1.js"></script>
<script src="./jstree/jstree.js"></script>

<script>
    $(function () {
        // //这个是关键，如果不清空实例，jstree不会重新生成
        // $('#deptTree').data('jstree', false).empty();

        $('#deptTree').jstree({
            'core': {
                // so that create works
                "check_callback": true,
                // 'data': {
                //     'url': "http://localhost:8081/findSonsByParentDictIdIncludeSelf/1",
                //     // 'data' : function (node) {
                //     //     return { 'id' : node.id };
                //     // },
                //     "dataType": "json" // needed only if you do not supply JSON headers
                //
                // },
                'data': function (obj, callback) {
                    var jsonarray = [];
                    $.ajax({
                        type: "GET",
                        url: "http://localhost:8081/findSonsByParentDictIdIncludeSelf/1",
                        // dataType: "json",
                        async: false,
                        success: function (result) {
                            var arrays = result;
                            for (var i = 0; i < arrays.length; i++) {
                                var arr = {
                                    "id": arrays[i].id,
                                    "parent": arrays[i].parent === "#" ? "#" : arrays[i].parent,
                                    "text": arrays[i].text
                                }
                                jsonarray.push(arr);
                            }
                        }
                    });
                    callback.call(this, jsonarray);
                }
            },

            "plugins": [
                "checkbox",
                "contextmenu",
                "dnd",
                "massload",
                "search",
                "sort",
                "state",
                "types",
                "unique",
                // "wholerow",
                "changed",
                "conditionalselect"
            ],
            'sort': function (a, b) {
                // return this.get_type(a) === this.get_type(b) ? (this.get_text(a) > this.get_text(b) ? 1 : -1) : (this.get_type(a) >= this.get_type(b) ? 1 : -1);
                return this.get_type(a) === this.get_type(b) ? (parseInt(this.get_json(a).id) > parseInt(this.get_json(b).id) ? 1 : -1) : (this.get_type(a) >= this.get_type(b) ? 1 : -1);
            },
        }).on('changed.jstree', function (e, data) {
            var i, j, r = [];
            for (i = 0, j = data.selected.length; i < j; i++) {
                r.push(data.instance.get_node(data.selected[i]).text);
            }
            console.log('Selected: ' + r.join(', '));
            console.log(data.changed.selected); // newly selected
            console.log(data.changed.deselected); // newly deselected
        });
    });
</script>
</body>
</html>
